<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <template id="report_sale_arrendamiento_document">
            <t t-call="web.external_layout">
                <t t-set="o" t-value="o.with_context(lang=lang)"/>
                <t t-set="doc" t-value="o"/>
                <t t-if="not company">
                    <!-- Multicompany -->
                    <t t-if="company_id">
                        <t t-set="company" t-value="company_id"/>
                    </t>
                    <t t-elif="o and 'company_id' in o">
                        <t t-set="company" t-value="o.company_id.sudo()"/>
                    </t>
                    <t t-else="else">
                        <t t-set="company" t-value="res_company"/>
                    </t>
                </t>
                <div class="page" style="text-align:justify; text-justify:inter-word; margin-right:5%; margin-left:10%;" t-if="o.id">
                    <style>
[class*="col"] > ol {
  padding-left: 13px;
}

[class*="col"] > ol li {
  position: relative;
}

[class*="col"] > ol li::before {
  content: attr(data-prefix) '.';
  position: absolute;
  left:-13px;
}

.especial-indent {
  padding-left:30px;
  text-indent:-30px;
}
                    </style>
                    <t t-set="cliente" t-value="o.partner_id"/>
                    <div class="oe_structure"/>
                                        
                    <div style="page-break-inside:avoid;" class="row text-center">
                        <div class="col-12">
                            <span><br/><br/>
                                <b><u>RESUMEN DE ESTADO DE ARRENDAMIENTO DE EQUIPOS</u></b>
                            </span><br/><br/>
                            <br/>
                        </div>
                    </div>
                    <div style="page-break-inside:avoid;">
                      <div style="margin-left;" class="row col">
                          <span>Codigo: <b><t t-esc="cliente.name or ''"/> 2021-</b></span>
                      </div>
                      <div style="margin-left;">
                          <span>Descripcion:
                            <b><span t-field="o.order_line[0].product_id.name"/></b>
                          </span>
                      </div>
                      <div style="margin-left;" class="row col">
                          <span>Cotizacion: <b>NÂ° <t t-esc="o.id"/>-2021/DRCR</b></span>
                      </div>
                      <div style="margin-left;" class="row">
                        <div class="col-4">
                          <span>Valorizacion: <b>SEMANAL</b></span>
                        </div>
                        <div class="col-4">
                          <span>P.Semanal: 
                            <t t-if="o.order_line.product_id.rent_ok == True">
                              <t t-if="o.order_line.product_id.rental_pricing_ids.unit == 'day'">
                                <b><t t-esc="o.order_line[0].product_id.rental_pricing_ids.price * 7" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: doc.pricelist_id.currency_id}" /></b>
                              </t>  
                              <t t-if="o.order_line.product_id.rental_pricing_ids.unit == 'week'">
                                <b><t t-esc="o.order_line[0].product_id.rental_pricing_ids.price" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: doc.pricelist_id.currency_id}" /></b>
                              </t>
                            </t>
                          </span>
                        </div>
                        <div class="col-4">
                          <span>P.Diario: 
                            <t t-if="o.order_line.product_id.rent_ok == True">
                              <t t-if="o.order_line.product_id.rental_pricing_ids.unit == 'day'">
                                <b><t t-esc="o.order_line[0].product_id.rental_pricing_ids.price" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: doc.pricelist_id.currency_id}" /></b>
                              </t>
                              <t t-if="o.order_line.product_id.rental_pricing_ids.unit == 'week'">
                                <b><t t-esc="o.order_line[0].product_id.rental_pricing_ids.price / 7" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: doc.pricelist_id.currency_id}" /></b>
                              </t>
                            </t>
                          </span>
                        </div>
                      </div>
                      <div style="margin-left;" class="row">
                        <div class="col-4">
                          <span>Equipo Entregado: 
                            <t t-if="o.order_line[0].qty_delivered != 0 ">
                              <span><b> SI</b></span>
                            </t>
                            <t t-if="o.order_line[0].qty_delivered == 0 ">
                              <span><b> NO</b></span>
                            </t>
                          </span>
                        </div>
                        <div class="col-4">
                          <span>Fecha de entrega: <b><t t-esc="o.order_line[0].pickup_date" t-options='{"widget": "date"}'/></b></span>
                        </div>
                        <div class="col-4">
                          <span>Guia JASATEC: <b></b></span>
                        </div>
                      </div>
                      <div style="margin-left;" class="row">
                        <div class="col-4">
                          <span>Equipo Devuelto: 
                            <t t-if="o.order_line[0].qty_returned != 0 ">
                              <span><b> SI</b></span>
                            </t>
                            <t t-if="o.order_line[0].qty_returned == 0 ">
                              <span><b> NO</b></span>
                            </t>
                          </span>
                        </div>
                        <div class="col-4">
                          <span>Fecha de devolucion: <b><t t-esc="o.order_line[len(o.order_line)-1].return_date" t-options='{"widget": "date"}'/></b></span>
                        </div>
                        <div class="col-4">
                          <span>Guia <t t-esc="cliente.name or ''"/>: <b>N/C</b></span>
                        </div>
                      </div>
                      <table class="table table-sm o_main_table" style="margin-top:15px;">
                        <thead>
                            <tr>
                                <th name="th_periodo" class="text-left"><b>PERIODO DE ALQUILER</b></th>
                                <th name="th_inicio" class="text-center">Inicio</th>
                                <th name="th_fin" class="text-center">Fin</th>
                                <th name="th_semanas" class="text-center">Semanas</th>
                                <th name="th_dias" class="text-center">Dias</th>
                                <th name="th_subtotal" class="text-right">Monto</th>
                                <th name="th_igv" class="text-right">IGV</th>
                                <th name="th_total" class="text-right">TOTAL</th>
                            </tr>
                        </thead>
                        <tbody class="periodo_tbody">
                          <t t-set="contador" t-value="0"/>
                          <t t-set="acum_dia" t-value="0"/>
                          <t t-set="acum_sem" t-value="0"/>
                          <t t-foreach="o.order_line" t-as="line">
                            <t t-set="contador" t-value="contador + 1"/>
                            <tr t-att-class="'bg-200 font-weight-bold o_line_section' if line.display_type == 'line_section' else 'font-italic o_line_note' if line.display_type == 'line_note' else ''">
                              <t t-if="not line.display_type">
                                <td name="td_periodo" class="text-left"><span>Periodo <t t-esc="contador"/></span></td>
                                <td name="td_inicio" class="text-center"><span t-esc="line.pickup_date" t-options='{"widget": "date"}'/></td>
                                <td name="td_fin" class="text-center"><span t-esc="line.return_date" t-options='{"widget": "date"}'/></td>
                                <td name="td_semanas" class="text-center"><span t-esc="(line.return_date - line.pickup_date).days // 7"/></td>
                                <td name="td_dias" class="text-center"><span t-esc="(line.return_date - line.pickup_date).days % 7"/></td>
                                <td name="td_subtotal" class="text-right"><span t-esc="line.price_subtotal" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: doc.pricelist_id.currency_id}"/></td>
                                <td name="td_igv" class="text-right"><span t-esc="line.price_tax" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: doc.pricelist_id.currency_id}"/></td>
                                <td name="td_total" class="text-right"><span t-esc="line.price_total" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: doc.pricelist_id.currency_id}"/></td>
                              </t>
                            </tr>
                            <t t-set="acum_sem" t-value="acum_sem + (line.return_date - line.pickup_date).days // 7"/>
                            <t t-set="acum_dia" t-value="acum_dia + (line.return_date - line.pickup_date).days % 7"/>
                          </t>
                        </tbody>
                        <tfoot>
                          <tr>
                            <t t-if="acum_dia > 7 ">
                              <t t-set="acum_sem" t-value="acum_sem + (acum_dia // 7)"/>
                              <t t-set="acum_dia" t-value="acum_dia % 7"/>
                            </t>                                
                            <td name="tf_totales" class="text-left"><span><b>Totales</b></span></td>
                            <td name="tf_inicio" class="text-center"><span><b><t t-esc="o.order_line[0].pickup_date" t-options='{"widget": "date"}'/></b></span></td>
                            <td name="tf_fin" class="text-center"><span><b><t t-esc="o.order_line[len(o.order_line)-1].return_date" t-options="{&quot;widget&quot;: &quot;date&quot;}"/></b></span></td>
                            <td name="tf_semanas" class="text-center"><span t-esc="acum_sem"/></td>
                            <td name="tf_dias" class="text-center"><span t-esc="acum_dia"/></td>                            
                            <td name="tf_subtotal" class="text-right"><b><span t-esc="o.amount_untaxed" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: doc.pricelist_id.currency_id}"/></b></td>
                            <td name="tf_igv" class="text-right"><b><span t-esc="o.amount_tax" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: doc.pricelist_id.currency_id}"/></b></td>
                            <td name="tf_total" class="text-right"><b><span t-esc="o.amount_total" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: doc.pricelist_id.currency_id}"/></b></td>
                          </tr>
                        </tfoot>
                      </table>
                      <table class="table table-sm o_main_table" style="margin-top:40px;">
                        <thead>
                            <tr>
                                <th name="th2_ejecucion" class="text-left"><b>EJECUCION DE PAGO</b></th>
                                <th name="th2_semana" class="text-center">Semanas</th>
                                <th name="th2_dia" class="text-center">Dias</th>
                                <th name="th2_os" class="text-center">O/S</th>
                                <th name="th2_monto" class="text-right">Monto</th>
                                <th name="th_factura" class="text-center">Factura</th>
                                <th name="th_constancia" class="text-center">Constancia</th>
                                <th name="th_observacion" class="text-center">Observacion</th>
                            </tr>
                        </thead>
                        <tbody>
                          <t t-set="acumulado" t-value="0"/>
                          <t t-foreach="o.invoice_ids" t-as="invoice">
                            <t t-set="acumulado" t-value="acumulado + invoice.amount_total"/>
                            <tr>
                              <td name="td2_ejecucion" class="text-left"><span>Periodo</span></td>
                              <td name="td2_semana" class="text-center"><span t-esc="(invoice.invoice_line_ids.sale_line_ids[len(invoice.invoice_line_ids.sale_line_ids)-1].return_date - invoice.invoice_line_ids.sale_line_ids[0].pickup_date).days // 7"/></td>
                              <td name="td2_dia" class="text-center"><span t-esc="(invoice.invoice_line_ids.sale_line_ids[len(invoice.invoice_line_ids.sale_line_ids)-1].return_date - invoice.invoice_line_ids.sale_line_ids[0].pickup_date).days % 7"/></td>
                              <td name="td2_os" class="text-center"><span>--</span></td>
                              <td name="td2_monto" class="text-right"><span t-esc="invoice.amount_total" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: doc.pricelist_id.currency_id}"/></td>
                              <td name="td2_factura" class="text-center"><span t-esc="invoice.name"/></td>
                              <td name="td2_constancia" class="text-center">--</td>
                              <td name="td2_observacion" class="text-center"><span t-esc="invoice.payment_state"/></td>
                            </tr>
                          </t>
                          <tr t-if="acumulado != o.amount_total">
                            <td name="td3_ejecucion" class="text-left" style="background-color:#ffff00;"><span>Periodo Restantes</span></td>
                            <td name="td3_semana" class="text-center" style="background-color:#ffff00;"><span>--</span></td>
                            <td name="td3_dia" class="text-center" style="background-color:#ffff00;"><span>--</span></td>
                            <td name="td3_os" class="text-center" style="background-color:#FF0000;"><span>Pendiente</span></td>
                            <td name="td3_monto" class="text-right" style="background-color:#ffff00;"><span t-esc="o.amount_total - acumulado" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: doc.pricelist_id.currency_id}"/></td>
                            <td name="td3_factura" class="text-center" style="background-color:#FF0000;"><span>Pendiente</span></td>
                            <td name="td3_constancia" class="text-center" style="background-color:#FF0000;"><span>Pendiente</span></td>
                            <td name="td3_observacion" class="text-center" style="background-color:#ffff00;"><span>Pendiente</span></td>
                          </tr>
                        </tbody>  
                      </table>
                    </div>
                    <div class="oe_structure"/>
                </div>
                
                    
            </t>
        </template>
        
        <template id="report_sale_arrendamiento">
            <t t-call="web.html_container">
                <t t-foreach="docs" t-as="o">
                    <t t-set="lang" t-value="user.sudo().lang"/>
                    <t t-call="mstech_jasatec2.report_sale_arrendamiento_document" t-lang="lang"/>
                </t>
            </t>
        </template>
    </data>
</odoo>
